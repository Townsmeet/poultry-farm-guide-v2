#!/usr/bin/env sh
set -e

# Function to process files with a command
process_files() {
    local pattern=$1
    local cmd=$2
    
    # Get list of staged files matching the pattern
    local files=$(git diff --cached --name-only --diff-filter=ACM | grep -E "$pattern" || true)
    
    # If there are matching files, process them
    if [ -n "$files" ]; then
        echo "$files" | xargs -r $cmd
        # Add the fixed files back to staging
        echo "$files" | xargs -r git add
    fi
}

# Run ESLint on staged JavaScript/TypeScript files
process_files '\.(js|jsx|ts|tsx|vue)$' 'npx eslint --fix'

# Run Prettier on all relevant staged files
process_files '\.(js|jsx|ts|tsx|vue|json|md|yml|yaml)$' 'npx prettier --write'
