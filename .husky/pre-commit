#!/usr/bin/env sh
set -e

# Function to process files with a command
process_files() {
    local pattern=$1
    local cmd=$2
    
    # Get list of staged files matching the pattern, using null terminators for safety
    git diff --cached --name-only -z --diff-filter=ACM | 
        grep -zE "$pattern" | 
        xargs -0 -r -I{} sh -c "$cmd \"{}\" && git add \"\$1\"" _ {}
}

# Run ESLint on staged JavaScript/TypeScript files
process_files '\.(js|jsx|ts|tsx|vue)$' 'npx eslint --fix'

# Run Prettier on all relevant staged files
process_files '\.(js|jsx|ts|tsx|vue|json|md|yml|yaml)$' 'npx prettier --write'
